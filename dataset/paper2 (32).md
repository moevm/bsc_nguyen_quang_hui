# Разработка метода кластеризации изображений, полученных с камер беспилотного автомобиля, с помощью нейронных сетей.

Ключевые слова: кластеризация, сегментация, нейронные сети.

## Аннотация

В статье был выполнен обзор существующих методов кластеризации изображений, выделены их недостатки
и преимущества и рассмотрена их применимость для обработки изображений, получаемых с камер беспилотного транспорта. На основе сравнительного анализа были сформированы требования к разрабатываемому методу и обозначены направления для дальнейшего исследования. 

## Введение

В настоящее время непрерывное увеличение количества аппаратных средств, являющихся источниками визуальной информации, приводит к тому, что обработка изображений становится одной из наиболее востребованных областей исследований. Кластеризация является важной частью анализа изображений, получаемых с камер беспилотного транспорта, из-за чего возникает необходимость в выборе наиболее быстрого существующего метода кластеризации или разработке нового.
Для решения проблемы метода кластеризации изображений, работающего в режиме реального времени, 
требуется рассмотреть существующие методы, решающие аналогичные задачи. 
Обзор аналогов позволит выявить их достоинства и недостатки, что поможет сформировать требования к решению данной проблемы. 
Целью работы является разработка метода кластеризации изображений, получаемых с камер беспилотного транспорта.
Объектом данного исследования являются методы кластеризации изображений, предметом - методы кластеризации для обработки изображений, 
получаемых с камер беспилотного транспорта. Для достижения цели требуется рассмотреть существующие методы кластеризации изображений 
с помощью нейронных сетей, сформировать критерии их сравнения, провести сравнительный анализ методов кластеризации изображений,
предложить метод кластеризации для возможной дальнейшей реализации для обработки изображений, получаемых с камер беспилотного автомобиля.


## Обзор предметной области
Аналоги в данной работе представляют собой методы кластеризации изображений городских пейзажей и изображений, 
получаемых с камер автомобилей. Для кластеризации изображения, выделении отдельных объектов на
изображении и их классификации, возможны три существующих подхода:
1. Семантическая сегментация — определение всех пикселей всех объектов заданных классов или фона на изображении. Если несколько объектов одного класса перекрываются, их пиксели не отделяются друг от друга;
2. Детектирование объектов — обнаружение всех объектов указанных классов и определение охватывающей рамки для каждого из них;
3. Сегментация экземпляров — определение пикселей, принадлежащих каждому объекту каждого класса по отдельности.
Возможные наборы данных, используемые для тестирования методов: CamVid[6], KITTI[8], Cityscapes[7]. 
Рассматривались статьи за период 2015-2019 г. Также аналоги подбирались по указанной возможности обработки изображений в режиме реального времени.

**ENet.**
ENet - архитектура глубокой нейронной сети для семантической сегментации в реальном времени [1]. Это нейросеть, 
представляющая собой тип свёрточной архитектуры шифратор-дешифратор (coder-encoder) и нацеленная на уменьшение количества 
используемых параметров и вычислительных операций для обеспечения возможности работы в режиме реального времени. 
Недостатком нейросети является потеря точности краёв формы из-за потери пространственной информации при субдискретизации. 
Авторы отмечают, что ENet превосходит нейросеть SegNet[2] по скорости и точности сегментации. Для обучения нейросети 
использовался градиентный метод Adam. Для нейросети применялось тестирование с использованием наборов данных Cityscapes и CamVid.

**SegNet.** 
SegNet - глубокая сверточная архитектура шифратор-дешифратор для pixel-wise семантической сегментации изображений [2], 
нацеленная на снижение количества параметров и времени обучения и повышение качества выделения объектов для возможности 
работы в режиме реального времени. SegNet представляет собой симметричную архитектуру, в которой дешифратор является 
отображением шифратора. Обучение сети проводится с помощью градиентного стохастического спуска. 
Проводилось тестирование нейросети на наборах данных CamVid и SUN RGB-D, в том числе в режиме реального времени.

**Mask R-CNN.**
Mask R-CNN - архитектура современной нейронной сети для сегментации объектов на изображениях [3]. Mask R-CNN позволяет 
выделять на фотографиях контуры («маски») экземпляров разных объектов. Сегментация объектов с помощью частично 
контролируемого обучения разбивает задачу сегментации экземпляра на подзадачи обнаружения рамок и выделения масок.
В обучении применяется метод обратного распространения ошибки. Авторы отмечают, что архитектура нейросети 
не оптимизирована по скорости, и лучшее соотношение скорость-точность может быть достигнуто, например, путем изменения 
размеров изображений. Метод был применен на наборе данных COCO, также применялось тестирование на наборе данных Cityscapes.

**Mask R-CNN.**
Mask R-CNN - архитектура современной нейронной сети для сегментации объектов на изображениях [3]. Mask R-CNN позволяет 
выделять на фотографиях контуры («маски») экземпляров разных объектов. Сегментация объектов с помощью частично 
контролируемого обучения разбивает задачу сегментации экземпляра на подзадачи обнаружения рамок и выделения масок.
В обучении применяется метод обратного распространения ошибки. Авторы отмечают, что архитектура нейросети 
не оптимизирована по скорости, и лучшее соотношение скорость-точность может быть достигнуто, например, путем изменения 
размеров изображений. Метод был применен на наборе данных COCO, также применялось тестирование на наборе данных Cityscapes.

**YOLO.**
You Only Look Once[4] - архитектура, выполняющая задачу детектирования объектов в реальном времени. Архитектура YOLO 
была основана на модели распознавания GoogleNet. YOLOv1 имеет 24 сверточных слоя, за которыми следуют 2 полносвязанных слоя FC. 
YOLO обрабатывает изображения в реальном времени и представляет собой единую нейронную сеть, которая применяется сразу ко всему 
изображению. Она одновременно выделяет и предсказывает ограничивающие объекты прямоугольники и вероятности нахождения в них 
объектов различных классов. В обучении используется метод обратного распросранения ошибки. Свёрточные слои предварительно обучаются 
на наборе Imagenet. Используя эту систему, достаточно единожды пропустить изображение через нейронную сеть, чтобы предсказать объекты и их расположение.

**ICNet.**
ICNet (Image Cascade Network) - нейросеть для сегментации изображений в режиме реального времени [5]. 
В архитектуре нейросети применяются каскадные модули, каждому из которых на вход подаются изображения с низким, средним и высоким 
изображением. Сегментация входных данных с высоким разрешением с помощью классических структур занимает много времени, чтобы 
преодолеть этот недостаток, применяется семантическое извлечение с использованием входных данных с низким разрешением. 
Чтобы получить качественную сегментацию, модули среднего и высокого разрешения помогают восстановить и уточнить грубое прогнозирование. 
При обучении, также, как и в других аналогах, применяется метод градиентного спуска. Данная работа нацелена на практически 
быструю семантическую систему сегментации с высокой точностью прогнозирования. В работе показано, что ICNet значительно 
превосходит нейросеть ENet[1] по точности сегментации (но уступает по скорости) и нейросеть SegNet [2] и по скорости, 
и по точности сегментации. Тестирование нейронной сети было проведено на наборах данных Cityscapes, CamVid and COCO-Stuff.

Для сравнения аналогов были выбраны следующие критерии: "Работа в режиме реального времени", 
"Выделение границ объектов", "Точность".

Далее приведено описание каждого из критериев.

**Работа в режиме реального времени.**
Обработка изображений, получаемых с камер беспилотного транспорта, является задачей, 
требующей максимально высокой скорости выполнения. Так-как невозможно сравнение скорости работы представленных
алгоритмов, ключевым критерием для сравнения является способность обрабатывать изображения 
в режиме реального времени. 

**Выделение границ объектов.**
Подобранные методы представляют собой принципиально разные подходы к решению поставленной задачи. 
Для беспилотного транспорта ключевым является обеспечение безопасности движения, поэтому важный фактор
при кластеризации изображений - чёткое выделение границ объектов. 

**Точность.**
Точность выделения кластеров определяет качество применяемой модели. Точность может выражаться разными метриками и обычно
определяется в процентах. Например, mean IoU — метрика точности для задач сегментации, представляет собой
усредненное по классам отношение правильно отмеченных пикселей к сумме числа пикселей данного класса и числа пикселей, 
отмеченных как данный класс.


Результаты сравнения рассмотренных методов по перечисленным критериям приведены в таблице 1.

Таблица 1 - Сравнение аналогов

Аналоги \ Критерии	    | Работа в режиме реального времени| Выделение границ объектов	    |  Точность			            |
------------------------|----------------------------------|--------------------------------|---------------------------|
ENet                    |           +	                     |                 +	            |	58.3% (class IoU на наборе данных Cityscapes)
SegNet    	            |           +	                     |                 +	            |   57.18% (mIoU на наборе CamVid)
Mask R-CNN              |           ?	                     |                 +	            |   36.4% (AP (усредненный по порогам IoU) на наборе данных Cityscapes 2048×1024px) |
YOLO	                  |           +	                     |                 -	            |   ?
Icnet                   |	    +	                           |                 +	            | 	69.5% (mIoU на наборе данных Cityscapes 1024x2048px) |


Такие критерии, как mean IoU, скорость, память, потребляемая графическим процессором, время обучения нейросети, обычно используемые для сравнения нейросетей 
для детектирования объектов, сегментации изображений, зависят от размеров используемых изображений набора данных для тестирования
и аппаратного обеспечения, поэтому невозможно объективно сравнить все методы, основываясь на данных, представленных в источниках. 
Тем не менее, в источнике 5 представлены тестовые результаты, показывающие преимущество сети ICNet перед сетью
SegNet[2] и ENet[1]. В таблице 2 представлены результаты сравнения моделей Icnet, ENet и SegNet из источника 5 для теста 
на наборе данных Cityscapes с разрешением 1024 × 2048.  «DR» обозначает коэффициент понижающей дискретизации изображения во время 
тестирования (например, DR = 4 представляет тестирование с разрешением 256 × 512):

Таблица 2 - Сравнение методов ICNet, ENet и SegNet на наборе данных Cityscapes

Аналоги\Критерии	      | mIoU (%)	    | Time(ms)	    | Frame(fps)	  | DR	  |
------------------------|---------------|---------------|---------------|-------|
ENet			              | 	58.3	      |	13	          |	76.9	        |  2	  |
SegNet			            |	57.0	        |	60	          |	16.7	        |  4    |
Icnet		              	|	69.5	        |	33	          |	30.3	        |  no   |

В процессе подбора аналогов было выяснено, что большая часть методов обработки изображений, получаемых с камер транспортных средств, 
относится к семантической сегментации [1, 2, 5]. При этом нейросеть Icnet значительно превосходит нейросети SegNet и ENet по скорости 
и точности сегментации. Нейросеть YOLO нацелена на обработку изображений в режиме реального времени, но выполняет только детектирование 
объектов, не определяя их точные границы. Mask R-CNN[3] применяется для сегментирования отдельных объектов, что является более сложной
задачей, чем семантическая сегментация, невозможно гарантировать, что данная нейросеть применима для обработки изображений в режиме реального времени.

## Выбор метода решения
Обзор аналогов показал, что обработка изображений, получаемых с камер транспортных средств, возможна в режиме реального времени. Для беспилотного транспорта характерно получение изображений в высоком разрешении за время, не превышающее 2мс. 
Решение должно представлять собой архитектуру нейронной сети, применимую для семантической сегментации изображений, получаемых с камер беспилотных автомобилей. 
При этом соотношение скорости работы и точности результата сегментации должно быть ключевым при разработке или улучшении существующей архитектуры. Для тестирования 
результата предпочтительно использование наборов данных KITTI, Cityscapes или CamVid, параметрами тестирования могут быть память, потребляемая графическим процессором (MB), 
скорость алгоритма(FPS), mean IoU(%, параметр для измерения точности сегментации), размер модели(MB), количество операций с плавающей запятой.
Решение должно обладать следующими характеристиками:
- высокая скорость обработки изображений, достаточная, для возможности работы алгоритма в режиме реального времени;
- высокая точность сегментации;
- использование как можно меньшего количества ресурсов (например, размер модели ENet может составлять всего 0,7 Мб);

## Описание метода решения
В качестве метода кластеризации в данной работе предлагается использование семантической сегментации, которую характеризует четкое выделение границ объектов и более лёгкая реализация по сравнению с применением сегментации экземпляров. Основой для разработки архитектуры нейронной сети для семантической сегментации изображений служат свёрточные нейронные сети. В широком смысле архитектура семантической сегментации может рассматриваться как кодирующая сеть, за которой следует декодирующая сеть. Кодирующая сеть обычно представляет собой предварительно обученную свёрточную нейронную сеть, применимую для классификации объектов. Декодирующая сеть семантически проецирует распознаваемые признаки (более низкое разрешение), изученные кодирующей сетью, на пространство пикселей (более высокое разрешение).

Для программной реализации метода предлагается применение фреймворка Caffe [9], являющегося средой для глубокого обучения, написанного
на языке С++ и поддерживающего интерфейс на Python. Caffe обеспечивает поддержку свёрточных нейронных сетей и нацелен в первую очередь на задачи классификации и сегментации изображений.
Для тестирования и обучения разрабатываемой нейронной сети предлагается использование набора данных KITTI, который включает в себя
изображения в высоком разрешении, получаемые с использованием автономной платформы для вождения. Сценарии изображений набора данных включают реальные транспортные ситуации и варьируются от автострад над сельскими районами до городских сцен с большим количеством статических и динамических объектов.
В качестве основы для разрабатываемой архитектуры предлагается использовать нейронную сеть ICNet, которая показала лучшие результаты при проведении сравнения аналогов.

## Заключение
В рамках данного исследования не была достигнута поставленная цель - разработка метода кластеризации изображений, получаемых с камер беспилотного транспорта, но были сформированы требования к методу для последующей реализации и возможные пути решения. Для этого
был проведен сравнительный анализ существующих методов кластеризации по следующим критериям: "работа в режиме реального времени", "выделение границ объектов", "точность". По результатам сравнения был сделан вывод о применении к решению задачи семантической сегментации.
Направление дальнейшего исследования включает в себя проведение анализа методов семантической сегментации на наборах реальных данных изображений, получаемых с камер беспилотного транспорта, разработку архитектуры нейронной сети, улучшающей показатели наиболее выгодного по анализу метода.
