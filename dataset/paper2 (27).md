# Сравнительный анализ подходов для решения задачи повышения качества данных розничной торговли 

Ключевые слова: розничная торговля, продажи, пропущенные значения, аномалии, аномальные значения, качество данных, полнота, точность

## Аннотация

Целью работы является формирование требований к алгоритму, повышающему полноту и точность данных о продажах в розничной торговле. В статье проанализированы аспекты качества данных, а также этапы, на которых они прорабатываются, проведен сравнительный анализ подходов устранения пропущенных и обнаружения аномальных значений, сформулированы критерии для сравнения и описаны существующие аналоги. На основе полученного сравнения сформированы требования к будущим алгоритмам и определены подходы для решения задачи повышения качества данных о продажах. В результате проделанной работы используемыми подходами были выбраны методы, основанные на моделировании, для восстановления пропусков и методы, основанные на алгоритме ближайшего соседа, для обнаружения аномалий. Проанализированы решения, входящие в состав выбранных подходов и, исходя из этого, было принято, что будут использованы алгоритмы, наиболее подходящие для заданной предметной области и дающие лучшие результаты по сравнению с остальными: для обработки пропущенных значений – EM-алгоритм, для аномальных значений – k-NN. Сформулирован способ повышения точности результата при использовании EM-алгоритма и уменьшения времени работы для метода k-NN. Предложены направления для дальнейших исследований.



## Введение

В современных условиях высококонкурентного сосуществования компаний розничной торговли особо остро стоит вопрос о качестве анализируемых данных. С целью принятия решений о дальнейших закупках, о формировании ассортимента, организации, занимающиеся розничной торговлей, осуществляют анализ данных о продажах. Работа с качественными данными позволяет фирмам быть уверенными в результатах, которых они достигают и соблюдать требования, регулируемые нормативными актами. Автоматизация процесса повышения качества данных даст шанс сотрудникам работать более продуктивно, не тратя время на проверку и исправление ошибок.

Проблема заключается во влиянии качества данных на их дальнейший анализ и конкурентоспособность компании. Использование алгоритма для автоматизации вышеуказанного процесса позволит повысить обоснованность решений на всех уровнях управления. 

Одними из аспектов качества данных являются их точность и полнота, на которые влияет наличие пропущенных и аномальных значений. В литературе и на практике существует широкий спектр методов по борьбе с ними, поэтому, прежде чем приступить к реализации программы, необходимо проанализировать существующие подходы. Объектом исследования являются алгоритмы устранения ошибок в данных о продажах в розничной торговле, а предметом – алгоритмы восстановления пропущенных и устранения аномальных значений в данных о продажах в розничной торговле. Для достижения поставленной цели требуется выполнить обзор предметной области, сформировать критерии и на их основе выполнить сравнение существующих подходов, описать требования к будущим алгоритмам.

## Обзор предметной области

Качество данных – это оценка пригодности данных для выполнения предполагаемой цели их использования.  Не существует общего соглашения ни о том, какой набор измерений определяет качество данных, ни о точном значении каждого измерения, так как качество всегда зависит от контекста, в котором оно используется, однако основные его аспекты, исследованные в [1], представлены ниже.

Аспекты качества данных:
- Полнота. Неполными считаются данные, в которых отсутствует часть записи (например, в сведениях о товаре не указано его наименование или какая-либо из количественных характеристик) или полностью отсутствует одна или несколько записей (например, при обновлении базы данных утрачена вся информация об одном из товаров).
- Согласованность. Данные согласованны, если все системы предприятия отражают одну и ту же информацию (данные в разных хранилищах согласованны). Например, номер телефона компании в одной базе должен совпадать с номером той же компании в другой базе.
- Точность. Точность данных, хранящихся в базе, определяется как степень, с которой они соответствуют реальным значениям. Например, стоимость товара должна быть введена с точностью до копейки.
- Своевременность. Степень, с которой данные являются актуальными для выполняемой задачи, называется своевременностью. На практике это значит, что аналитики извлекают всю необходимую информацию из баз данных с минимальной задержкой между изменением состояния реального мира и обновлением состояния информационной системы. 
- Действительность. Данные действительны, если они соответствуют установленным стандартам, типу, формату и диапазону. Например, для полей, в которых указывается дата и время, необходимо установить единый формат записи.
- Уникальность. Данные являются уникальными, если каждая запись является уникальной, то есть отсутствует её дублирование.

Каждый из аспектов прорабатывается на определенном этапе, всего выделяют 5 этапов: профилирование, стандартизация, очистка, обогащение и дедупликация (подробнее о каждом из этапов можно прочесть в [1, 2, 3]). Повышение точности и полноты данных, исследуемое в работе, осуществляется на этапе очистки. 

На этапе очистки в существующих данных выявляются и исправляются различные ошибки, такие как аномалии, противоречия, шум, пропущенные значения, устраняются неточности, оценивается достоверность информации. В данной статье рассматриваются аномальные и пропущенные значения.

## Сравнение аналогов

Для решения заявленной проблемы сначала необходимо выполнить сравнение существующих подходов устранения пропущенных значений, а также подходов обнаружения аномалий. Для поиска использовались системы «Google Академия», «Cyberleninka», «Elibrary» и «ResearchGate». Проанализированы научные статьи, имеющие цитирование, либо опубликованные позже 2015 года.

## Сравнение подходов устранения пропущенных значений

Подходы, выполняющие устранение пропусков, можно разделить на группы по способу их обработки. Далее представлена их группировка.

Методы, выполняющие устранение пропусков, можно объединить в группы по способу их обработки. Далее представлена их группировка.
В источнике [4] выделяют методы, основанные на удалении строк. К ним относят следующие:  
- Парное удаление, при котором исключаются строки, в которых присутствует хотя бы один пропуск по выбранным для анализа переменным; 
- Списковое удаление, при котором производится исключение строк, в которых имеется хотя бы одно пропущенное значение.

В [5,6] выделяют в отдельную группу методы с заполнением, в которых пропуски заменяются значениями, вычисленными различными способами.  Данный поход включает следующие методы: 
- Заполнение с пристрастным подбором, когда подставляются значения других строк выборки; 
- Заполнение средними, когда выполняется подстановка среднего арифметического, медианы или моды; 
- Заполнение с помощью регрессии, когда происходит заполнение значениями, предсказываемыми регрессией пропущенных для данной строки ячеек, на присутствующие, вычисляемые по заполненным строкам. 
- Множественное заполнение, когда пропущенное значение заменяется рассчитанным не однократно, а несколько раз.

В [5] описаны методы моделирования, которые основываются на построении модели порождения пропусков. Выводы получают с помощью функции правдоподобия, построенной при условии справедливости этой модели, с оцениванием параметров методами типа максимального правдоподобия. К ним относят: 
- Метод одновременной максимизации по параметрам и пропущенным значениям;
- ЕМ-алгоритм.

В [7, 8] в отдельную группу выделяют методы семейства Zet(Wanga), построенные на гипотезе локальной компактности. В ней выделяются следующие методы: 
- WANGA-R; 
- WANGA-N; 
- WANGA-I; 
- WANGA-0.

Еще одной группой представлены методы взвешивания, основанные на том, что рандомизированные выводы по данным выборочных столбцов с пропусками построены на весах плана, обратно пропорциональных вероятности выбора. При использовании данных методов строкам с полными данными устанавливают вес таким образом, чтобы их распределение было приближено к распределению полной выборки или совокупности по выбранным переменным [4, 5].

## Критерии сравнения подходов устранения пропущенных значений

Исходя из особенностей данных о продажах можно сформировать критерии для сравнения существующих аналогов.
- Тип пропусков

В данных о продажах пропуски могут быть случайны (в результате невнимательности, например), то есть иметь механизм формирования MCAR (Missing Completely At Random), а могут иметь некоторую зависимость с другими данными (например, сведения о количестве товара в упаковке или о его массе зависит от наименования товара), то есть иметь механизм формирования MAR (Missing At Random), необходимо учитывать оба этих случая.
- Искажение распределения

При обработке пропущенных значений важно, чтобы отсутствовало искажение распределения, которое приводит к смещению статистических оценок.
- Уменьшение данных

Уменьшение данных может привести к недостаточному для анализа объему выборки или полному их отсутствию, поэтому стоит избегать методов, влияющих на объем данных.

## Сравнение подходов устранения пропущенных значений

Результаты сравнения вышеперечисленных аналогов по выделенным критериям представлены в табл. 1.

Таблица 1 - Сравнение подходов устранения пропущенных значений

|                                              | Тип пропусков | Уменьшение данных | Искажение распределения |
|----------------------------------------------|---------------|-------------------|-------------------------|
| Удаление строк                               |      MCAR     |         +         |            -            |
| Методы с заполнением                         |      MAR      |         -         |            +            |
| Методы, основанные на моделировании          |   MAR, MCAR   |         -         |            +            |
| Локальные алгоритмы восстановления пропусков |      MAR      |         -         |            -            |
| Методы взвешивания                           |      MAR      |         +         |            -            |

По итогам сравнения можно сделать вывод, что для устранения пропущенных значений подходящим инструментом являются методы, основанные на моделировании. Использование подходов, основанных на модели порождения пропусков, позволяет работать с данными, отвечающими условию MCAR и MAR, в отличие от других инструментов, а также не приводит к уменьшению данных.

## Сравнение подходов обнаружения аномальных значений

Подходы, выполняющие обнаружение аномалий, можно классифицировать по способу их реализации, классификация представлена ниже.

В [9,10] методы объединяются в подход, основанный на статистическом анализе. В нем выдвигается предположение о том, что корректные данные находятся в области высокой вероятности стохастической модели, в то время как аномальные значения – в низкой. Данные методы, в свою очередь, подразделяются на следующие подгруппы: 
- Параметрические методы, основанные на гауссовской и регрессионной моделях; 
- Непараметрические методы, основанные на гистограммах.

Для группировки схожих элементов в кластеры используется кластеризация. Методы обнаружения аномалий на основе кластеризации описаны в [10,11] и их можно разделить на два вида. Первый вид основан на следующем предположении: корректные данные лежат в кластере, а аномалии не принадлежат ни одному кластеру. Второй вид зависит от следующего предположения: корректные данные относятся к большому и плотному кластеру, а аномалии – к небольшим кластерам.

Группа методов, называемых классификацией и описанных в [11], основана на предположении того, что корректные данные определяются одним или несколькими классами, а аномальным считается значение, не принадлежащее ни к одному классу. К данным методам относят следующие: 
- Методы на основе нейронных сетей; 
- Метод опорных векторов (SVM); 
- Байесовская сеть; 
- Генетический алгоритм;

Концепция методов, основанных на алгоритме ближайшего соседа и описанных в [12], строится на следующем предположении: корректные данные находятся в одной окрестности, в то время как отклонения удалены от их ближайших соседей на расстояние, превышающее расстояние между корректными данными. Методы обнаружения аномалий на основе ближайших соседей можно разделить на две категории: 
- Методы, использующие расстояние до его k-го ближайшего соседа в качестве показателя аномалии; 
- Методы, вычисляющие плотность каждого экземпляра данных в качестве показателя аномалии.

В [13] в отдельную группу выделяются спектральные методы, находящие аппроксимацию данных, используя набор параметров. Описанный подход основан на предположении того, что данные могут быть вложены в меньшее подпространство, в котором корректные значения и аномалии выглядят отлично друг от друга и могут быть идентифицированы. К данным методам относят: 
- PCA (Principal Component Analysis); 
- CMD (Compact Matrix Decomposition).

## Критерии сравнения подходов обнаружения аномальных значений

Исходя из особенностей данных о продажах можно сформировать критерии для сравнения существующих аналогов.
- Режим обнаружения

Данные о продажах не имеют какой-либо информации об экземплярах корректного и аномального классов, а значит необходимо использовать режим обнаружения без учителя (Unsupervised anomaly detection).
- Результат работы

Результатом выполнения методов обнаружения аномалий может быть либо пометка значения как аномального, либо оценка вероятности того, что оно аномальное. Второй результат более предпочтителен, так как позволяет пользователю самостоятельно принять решение о том, какие из значений являются отклонениями.
- Временная сложность работы

Важно учитывать временную сложность работы алгоритма, так как при больших объемах данных работа программы может занять длительное время.

## Сравнение подходов обнаружения аномальных значений

Результаты сравнения вышеперечисленных аналогов по выделенным критериям представлены в табл. 2.

Таблица 2 - Сравнение подходов обнаружения аномальных значений

|                                                   | Режим обнаружения            | Результат работы | Временная сложность работы                          |
|---------------------------------------------------|------------------------------|------------------|-------------------------------------------|
| Статистический анализ                             |        Semisupervised        |    Вероятность   |                   O(n)                    |
| Кластеризация                                     | Semisupervised, Unsupervised |      Пометка     |                   O(n^2)                  |
| Классификация                                     |  Semisupervised, Supervised  |      Пометка     |                   O(n)                    |
| Методы, основанные на алгоритме ближайшего соседа |         Unsupervised         |    Вероятность   |                   O(n^2)                  |
| Спектральные методы                               | Semisupervised, Unsupervised |      Пометка     |                   O(n)                    |

По итогам сравнения аналогов можно сделать вывод, что наиболее подходящей группой методов для обнаружения аномалий в данных о продажах в розничной торговле является группа, основанная на алгоритме ближайшего соседа. Методы, входящие в нее, позволяют использовать режим обнаружения без учителя и в качестве результата возвращают оценку вероятности того, что обнаруженные значения являются аномальными, тем самым давая пользователю возможность самостоятельно решить, какие экземпляры содержат отклонения.

## Выбор метода решения

В результате сравнения аналогов были показаны преимущества использования методов, основанных на моделировании, для устранения пропущенных значений, а также методов, разработанных на основе алгоритма ближайшего соседа, для обнаружения аномальных значений.

Подход, основанный на моделировании, позволяет работать с данными, отвечающими условию MCAR и MAR, не приводит к уменьшению данных. Кроме того, он дает возможность оценивать в приближении выборки дисперсии оценок с помощью матрицы вторых производных функций правдоподобия для неполных данных, обеспечивает надежную сходимость, то есть в определенных нестрогих условиях каждая итерация увеличивает логарифм правдоподобия, и последовательность сходится к некоторому стационарному значению. 

Методы, основанные на алгоритме ближайшего соседа, позволяют использовать режим обнаружения без учителя, а в качестве результата возвращают оценку вероятности того, что обнаруженные значения являются аномальными. Также эти методы широко адаптированы, поскольку они не контролируются.  Адаптация методов на основе ближайшего соседа к другому типу данных проста и требует определения метрики для измерения расстояния между экземплярами. 

Для решения заявленной проблемы влияния качества данных на их дальнейший анализ и конкурентоспособность компаний в области розничной торговли будут использованы подходы, ставшие лучшими при сравнении аналогов.

## Описание метода устранения пропущенных значений

На основе обзора существующих решений можно сформировать требования к алгоритму устранения пропущенных значений:
- Должна осуществляться обработка данных с пропусками типа MAR и MCAR;
- Программа не должна осуществлять удаление данных, содержащих пропуски, которое приводит к уменьшению выборки.

Подход, основанный на моделировании, удовлетворяет описанным требованиям. В работе [14] проведено исследование EM-алгоритма и регрессионного моделирования, выполнен их сравнительный анализ, описаны достоинства и недостатки каждого метода. Дисперсия в результате выполнения EM-алгоритма становится на 10% меньше, нежели при использовании регрессионного моделирования, то есть в первом случае наблюдается более сильное искажение распределения. Однако ЕМ-алгоритм лучше справляется с задачей при увеличении доли пропусков в данных, а также при наличии большой дисперсии значений, которая может наблюдаться в данных о продажах, что делает данный метод более предпочтительным для использования. Именно он будет взят в качестве основы для устранения пропущенных значений в данных о продажах, а в дальнейшем к нему будет добавлен алгоритм для повышения точности результатов. 

## Описание метода обнаружения аномальных значений 

Требования к алгоритму обнаружения аномальных значений:
- Программа должна работать в режиме обнаружения без учителя;
- Результатом работы алгоритма должна быть оценка вероятности отклонения значения.

Подход, основанный на алгоритме ближайшего соседа, удовлетворяет описанным требованиям и включает в себя методы, использующие в качестве показателя аномалии расстояние до его k-го ближайшего соседа или плотность каждого экземпляра. В работе [15] осуществлен сравнительный анализ алгоритмов, принадлежащих описанному выше подходу: k-NN (k-nearest neighbors), LOF(Local Outlier Factor), COF(Connectivity-Based Outlier Factor), INFLO(Influenced Outlierness), LoOP(Local Outlier Probability), LOCI(Local Correlation Integral) и aLOCI(Approximate Local Correlation Integral). В статье были сделаны следующие выводы: локальные алгоритмы, такие как LOF, COF, INFLO и LoOP, часто имеют тенденцию ложных срабатываний; LOCI требует длительного времени на выполнение для больших наборов данных; aLOCI имеет низкую стабильность результатов. Хотя LoOP был наиболее эффективным, в большинстве случаев он дает сбой. Рекомендованным к использованию стал алгоритм k-NN. 

Для обнаружения аномальных значений в данных о продажах будет применен метод k-NN, однако алгоритм довольно медленный (его временная сложность O(n^2)), так как он каждый раз просматривает все экземпляры. Для повышения скорости работы будет использована кластеризация для разбиения данных на более мелкие группы, чтобы устранить необходимость проверки каждого экземпляра. 

## Заключение

В данной работе представлен сравнительный анализ подходов для решения задачи повышения качества данных розничной торговли. Исследованы основные аспекты качества данных и этапы их проработки, сформированы критерии и описаны существующие решения. В результате сравнения аналогов было выявлено, что методы, основанные на моделировании, для устранения пропущенных значений имеют преимущество в виде отсутствия строгих требований к типу пропусков и отсутствия влияния на размер выборки, а методы, основанные на алгоритме ближайшего соседа, для обнаружения аномалий предпочтительны вследствие возможности использовать режим обнаружения без учителя и получать результат в виде оценки вероятности, насколько то или иное значение отклоняется от остальных. Сформированы требования к алгоритмам, осуществляющим обработку пропущенных и аномальных данных, описанные выше подходы им удовлетворяют, поэтому именно они выбраны для решения поставленной проблемы. 

Проанализированы методы, входящие в состав выбранных подходов и решено, что будут использованы алгоритмы, наиболее подходящие для заданной предметной области и дающие лучшие результаты по сравнению с остальными: ЕМ-алгоритм для восстановления пропусков и k-NN для обнаружения аномальных значений. При этом отмечено, что EM-алгоритм будет взят в качестве основы, а в будущем к нему будет добавлен другой метод для получения более точного результата, для k-NN будет реализована кластеризация в целях повышения скорости работы программы.

В качестве дальнейших исследований предлагается рассмотреть способы оптимизации EM-алгоритма, а также анализ LOF алгоритма на различных данных розничной торговли.  
