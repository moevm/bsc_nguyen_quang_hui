# Разработка сервиса для интеграции отчетов SonarQube в цикле Continuous Delivery

Ключевые слова: html-отчет, SonarQube, Jenkins.

## Аннотация

В данной статье рассмотрены причины необходимости создания сервиса для интеграции автоматических отчетов SonarQube, выполнен анализ существующих решений для генерации отчетов. При сравнительном анализе аналогов были выявлены недостатки, которые были учтены при формировании функциональных требований к разрабатываемому сервису. Предложены ключевые состовляющие html-отчета, а также предложено направление для дальнейших исследований.

## Введение

В наше время каждая успешная сборка продукта внутри компании заканчивается анализом кода. Формирование отчета возможно на самом сервере SonarQube. Клиенты, разработав свой код, получают отчет о выявленных дефектах, сформированный вручную сотрудниками компании, что занимает большой объем времени.  Рассматриваемая проблема заключается в автоматическом формировании отчетов по выявлению дефектов кода для предоставления клиентам в рамках поставки.

Целью данной статьи является разработка сервиса для интеграции автоматических отчетов SonarQube. Объектом исследования является анализатор кода SonarQube. В качестве предмета исследования выступает процесс формирования отчета по выявлению дефектов.

Для достижения поставленной цели требуется решить следующие задачи:

1. Обзор существующих решений по генерации отчетов.
2. Сравнение существующих решений по генерации отчетов.
3. Определение набора требований для реализации сервиса генерации отчетов.
4. Формирование шаблона html-отчета

## Обзор предметной области

### Принцип отбора аналогов

Средств, решающих поставленные задачи в полном объеме не обнаружено, поэтому были выбраны аналоги, которые позволяют генерировать html-отчеты, имеют интеграцию с SonarQube, а также имеют возможность использоваться в системе непрерывной интеграции.

### PVS-Studio

Данный инструмент позволяет выявлять ошибки и потенциальные уязвимости в исходном коде программ. PVS-Studio выполняет статический анализ кода и и позволяет сохранять результаты анализа в формате html. Работает в 64-битных системах на Windows, Linux и macOS и может анализировать код, предназначенный для 32-битных, 64-битных и встраиваемых ARM платформ. Для Windows и Linux предусмотрены специальные утилиты, собирающие информацию о запусках компилятора. Эти инструменты позволяют быстро выполнить анализ проекта, собираемого любым способом.[1]

### Allure

Инструмент построения отчётов в формате html, который позволяет получить краткую информацию о ходе выполнения тестов, а также предоставляет информацию из повседневного выполнения автоматизированных тестов. Отчет генерируется в два этапа. Первый этап: во время выполнения теста небольшая библиотека, называемая адаптером, присоединенная к платформе тестирования, сохраняет информацию о выполненных тестах в файлы XML. Второй этап: во время создания отчета файлы XML преобразуются в отчет HTML.[2]

### Sonar PDF Report Plugin

Данный инструмент позволяет создавать отчеты по выявленным дефектам с наиболее актуальной информацией из веб-интерфейса SonarQube. Данный плагин позволяет генерировать отчет PDF после каждого анализа в SonarQube.[3]

### CodeSonar

CodeSonar позволяет анализировать и проверять исходный и двоичный код, выявляя серьезные уязвимости, которые могут привести к сбоям системы, низкой надежности, системным сбоям или небезопасным условиям. Анализ может выполняться параллельно, чтобы максимально использовать преимущества многоядерных сред. Также позволяет генерировать отчеты по встроенным шаблонам и создавать собственные шаблоны. Сгенерированные отчеты можно экспортировать в виде файла html.[4]

###  FastReport.Net

Данный инструмент позволяет создавать отчеты, работающие независимо от приложения, то есть может быть использован как самостоятельное решение для построения отчетов. Cодержит визуальный дизайнер для создания и модификации отчетов. Расширяемая архитектура FastReport.Net позволяет создавать и подключать к отчету свои объекты, фильтры экспорта, функции, движки БД. Существует возможность увидеть результат в окне предварительного просмотра, вывести отчет на печать, а также сохранить отчет во множестве форматов, в том числе html.[5]

В качестве критериев сравнения аналогов были выбраны:

1. HTML формат - возможность формирования отчета по выявленным дефектам в формате html.

2. Интеграция с SonarQube - возможность формирования отчета по работе анализа кода SonarQube.

3. Интеграция с Jenkins - возможность интегрировать отчеты по выявлению дефектов в систему непрерывной интеграции Jenkins.

По выбранным критериям было проведено сравнение существующих решений. Результаты представлены в табл. 1.

Таблица 1 - Сравнение аналогов

|                               | PVS-Studio | Allure | Sonar PDF Report Plugin | CodeSonar |  FastReport.Net |
|-------------------------------|------------|--------|-------------------------|----|------|
| HTML формат                   |     +      |   +    |           -             |     +     |        +        |
| Интеграция c SonarQube        |      -     |    -   |           +             |     -     |        -        |
| Интеграция с Jenkins          |     +      |    +   |            +            |     +     |        -        |

## Выводы по итогам сравнения

PVS-Studio, Allure, CodeSonar, могут быть использованы в системе непрерывной интеграции Jenkins, что позволяет автоматизировать процесс генерации отчетов, также позволяют генерировать html отчеты. Однако данные решения не поддерживают интеграцию с SonarQube. 

Рассмотренный аналог FastReport.Net позволяет генерировать html-отчеты, а также благодаря расширяемой архитектуре позволяет добавлять к отчету дополнительно объекты, которые необходимы для генерации отчета, однако не поддерживает интеграцию с SonarQube и Jenkins.

Плагин Sonar PDF Report не позволяет генерировать html отчеты, что не подходит согласно поставленным задачам.

## Выбор метода решения

В ходе обзора главным недостатком аналогов стало отстутствие поддержки интеграции с SonarQube. 

В результате были сформированы требования для нового программного решения.

Решение должно обладать следующими качествами:

- Генерация отчета должна происходить в формате html.
- Решение должно работать в системе непрерывной интеграции Jenkins.
- Решение должно автоматизированно генерировать отчеты исходя из анализа кода SonarQube.

## Описание метода решения

Шаблон html-отчета должен включать в себя:
-имя файла;
-код и название ошибки;
-строка где выявлена ошибка;
-критичность ошибки;
-описание ошибки.

Требования к сервису заключаются в следующем:
-формат отчета - html файл
-отчет должен содержать выявленные ошибки по анализу кода SonarQube
-отчет должен интегрироваться в систему Jenkins.

## Заключение

В рамках данного исследования проведен сравнительный анализ существующих решений по генерации отчетов по следующим критериям: интеграция с SonarQube, возможность формирования отчета по выявленным дефектам в формате html, а также возможность интегрировать отчеты в систему непрерывной интеграции Jenkins.

По результатам сравнения сделан вывод о необходимости разработки сервиса, который способен интегрировать html-отчеты SonarQube в систему непрерывной интеграции Jenkins. Также определен набор требований для реализации сервиса генерации отчетов.

В качестве дальнейшего исследования возможно добавление описания реализации сервиса по генерации отчетов SonarQube.
