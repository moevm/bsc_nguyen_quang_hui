# Сравнительный анализ методов монокулярной визуальной одометрии как способа восстановления траектории движения

Ключевые слова: Визуальальная одометрия, монокамера, траектория, перемещение (!)

# Aннотация (!)

Целью данной статьи было проведение сравнительного анализа существующих решений на предмет определения точного пути движения одной камеры в пространстве.
В ходе работы был проведен обзор существующих методов, выяснено какие алгоритмы используются чаще всего (sift, orb, fastcorner, klt). Для повышения точности используется методы основанные дескрипторах ключевых точек(sift, orb). В главе "решение поставленных задач" есть ссылки на репозиторий github и azure, где предоставлен для вычисления матрицы ессенции и приложение для определения пути на основе последовательности выпрямленных кадров. Данная статья будет полезна тем, кто заинтересован в определении положении камеры, например в беспилотных автомобилях или в роботах.

# Введение 

Возможность определения перемещения робота или устройства в пространстве это важная функция объекта в роботехнике и в современном мире. 
Методы, основанные на одометрии, позволяют оценить пройденный путь на основе данных, полученных с помощью камер, датчиков или счетчиков оборотов.
Визуальная одометрия это метод ,который позволяет на основе потока изображений оценить премещение и поворот камеры.
Существующие методы, которые решают проблему, основаны на использовании моно и стерео камер, лазерных и gps датчиков.
В отличии от других методов визуальная одометрия применима в средах, где нет gps сигнала, например при экспедиции марсохода curiosity или при исследовании морского дна.
Главное достоинство этого метода заключается в том, что ему не требуется сложных и дорогостоящих сенсоров.
Напротив, один из недостатков этого способа состоит в плохой оценке перемещения.
Актуальность данной работы заключается в том, что если уменьшить ошибку оценки визуальной одометрии, то проблема будет решена. 
Статья направлена на предложение подхода к решению проблемы определения точного пути движущегося объекта в трехменом пространстве на основе данных, полученных с помощью одной камеры.
Целью данного исследования является проведение сравнительного анализа существующих решений на предмет определения точного пути движения одной камеры в пространстве и предложение собственного решения.
Объектом исследования являются методы визуальной одометрии, а предметом исследования - точность определения положения камеры в пространстве на основе видеопотока с одной камеры

Данная работа ставит следующие задачи:
1. Провести сравнительный анализ существующих методов
2. Исследовать достоинства и недостатки 
3. Предложение собственной архитектуры метода
4. Анализ результатов

# Обзор предметной области

Что бы провести обзор аналогов, выбирались такие методы визуальной одометрии (ВО), в которых использовались различные алгоритмы и последовательности действий, чтобы определить путь объекта по монокамере без информации с других сенсоров. 
Весь метод ВО можно грубо разбить на следующие шаги:
1) Выпрямить изображение на фреймах (убрать радиальное искажение, полученное вследствие физических свойств линз камеры).
2) Найти множество ключевых точек на i-ом фрейме.
3) Найти соответствие ключевых точек на следующих кадрах.
4) Зная перемещение ключевых точек, вычислить перемещение камеры по двум фреймам.
Шаги 2-4 допускают различное выполнение, поэтому акцент отбора аналогов сделан на анализе этих этапов и оценкой их точности, скорости и простоте реализации. Основные требования к аналогам - в методе ВО импользуются алгоритмы, которые улучшают точность определения перемещения за меньшее время, по сравнению с аналогом №1


### Первый подход к решению проблемы

Авторы этого метода[1] Давид Нистер, Олег Народитский и Джэймс Берген предоставили метод, в котором впервые изложили систему визуальной одометрии.
Здесь описывается примитивный подход к решению проблемы.
Авторы предлагают использовать следующий метод ВО:
1) Нахождение ключевых точек проводится с помощью углового алгоритма Хариса[2]
2) Сравнение точек происходит за счет вычисления корреляции двух точек 
3) Востановление перемещения проводится за счет триангуляции ключевых точек
Этот метод по сравнению с другими аналогами прост в исполнении, однако минусом будет неоптимальное и медленное выполнения, потому что ключевых точек может быть много и с их ростом затраченное на сравнение время возрастает с факториальной скоростью

### Современный стандарт

В статье по визуальной одометрии (две части [3,4]) проведен обзор методов за последние 30 лет (2011 год) и делают вывод об оптимальном варианте. Авторы анализируют различные комбинации алгоритмов и приходят к выводу, что оптимальным будет следующий метод:
1) Использование таких алгоритмов как SIFT[5], ORB[6] - для нахождения ключевых точек
2) Для нахождения ключевых точек на последующих кадрах - SIFT и ORB дескрипторы ключевых точек
3) Вычисление матрицы ессенции.  
  

### Примение bundle adjustment

В данном методе [9] улучшается точность определения пути при помощи BUNDLE ADJUSTMENT[10]. Проблема состоит в том, что триангуляция дает ошибку, от чего вычисленная траектория приводит к дрифту - ситуация когда из-за ошибки настоящий путь отличается от вычисленного. Этот алгоритм за счет обработки не двух а больше фреймов за раз позволяет уменьшить ошибку и дает более точный триангулированный путь. Ценой за этот метод служат большие затраты на память и на время обработки кадров. Автор предлагает добавления дополнительного шага к методу для обработки ошибки после нахождения ключевых точек 

### Смещение ключевых точек на основе цифрового потока KLT

Этот аналог[11], использует алгоритм Лукаса-Канаде для нахождения смещения ключевых точек на основе оптического потока. Этот алгоритм определяет смещение каждого пикселя на последовательности кадров и по сложности обработки данных легче и быстрее, по сравнению с алгоритмами, основаных на дескрипторах ключевых точек, но уступает в точности их соотненсения. Предложенный метод может выглядеть так:
1) Алгоритм Хариса[2]
2) KLT
3) Вычисление матрицы ессенции


## Критерии сравнения аналогов

Исходя из цели, оговоренной в введении, критерии были выбраны следующие - 
1) Точность определения пути - 
Критерий, отсутствие которого является критичным для методов ВО. Измеряется в процентах отклонения от ground truth значений. Значение удовлетворительное если оно не превышает 5% 
2) Скорость работы -
Измеряется время обработки одного кадра. Значение подходит если оно не превышает 0.5 секунд для одного кадра. Если время обработки велико, то метод не подходит для сисетм реального времени, что важно для автономных устроиств. 
3) Открытость програмного обеспечения -
Критерий, который задает планку для исследователя. Метод является простым для реализации, его компоненты используют открытый код. Например, Sift алгоритм - комерцианализован и его код не доступен в открытом доступе, поэтому под критерий такой метод использующий этот алгоритм не подойтет  

|                      | Аналог 1   | Аналог 2 | Аналог 3 | Аналог 5 |
| -------------------- | :--------: | :------: | :------: | :------: |
| Точность             |     Нет    |    ДА    |     да   |       НЕТ|
| Скорость             | ДА         |  Да      | Нет      | Да       |
| Простота реализации  | Да         |  Нет     |  Да      | Нет       |

Да - аналог подходит под критерий.
Нет - аналог не подходит под критерий.

## Выводы по итогам сравнения

Из предыдущей главы "Критерии сравнение аналогов" можно сделать вывод, что половина аналогов схожи по точности распознавания, при этом методы довольно сильно различаются по ресурсоемкости. Например, использование sift или orb дескрипторов обеспечивает надежное распознование ключевых точек, когда KLT трекер выигрывает в скорости обработки.  Также было выяснено, что, как правило, все методы используют одни и те же признаки, но в разном сочетании.

# Выбор метода решения

Приложение в режиме реального времени вычисляет перемещение камеры и строит путь, применяя алгоритмы, выбранные пользователём.

Качества - 
1) Возможность пользоваетеля выбрать определенный алгоритм (SIFT, ORB или KLT) и на своих данных посмотреть то, как работает алгоритм
2) Использование различных алгоритмов определения ключевых точек
3) Использование различных алгоритмов идентификации ключевых точек на следующих кадрах
4) Возможность использования предложенного метода 

В следующих разделах будет будет проведен анализ всех алгоритмов из обзора.


# Решение поставленных задач

Код программы написан на Python 3.7 и использует открытые алгоритмы из библиотеки opencv версии 4.1.0 . В ходе работы были получены следующие результаты - написан код[12] для нахождения матрицы ессенции и на этой основе получено перемещение камеры по ключевым точкам[13].
картинка
Написано приложение, где используется fastcorners, klt для построения пути по последовательности кадров (результаты находятся в [14]).
картинка
 

# Заключение

В ходе данного исследования в главе "Выводы по итогам сравнения" был проведен обзор существующих методов монокулярной одометрии и выявлено, что SIFT алгоритм дает низкий уровень ошибки и проигрывает в скоротости обработки данных. Алгоритм ORB вместе с KLT - напротив выигрывает в скорости оценки пути ценой увеличения погрешности. К сожалению, в связи нехватки времени не удалось достигнуть всех целей, а именно разработка собственного метода и исследование колличественных характеристек критериев. В дальнейшем предлагается разработать метод отбора ключевых точек и удаление движущихся объектов. 


# Список литературы


[1] - http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.205.9662&rep=rep1&type=pdf

[2] - http://www.bmva.org/bmvc/1988/avc-88-023.pdf

[3] - http://rpg.ifi.uzh.ch/docs/VO_Part_I_Scaramuzza.pdf

[4] - http://rpg.ifi.uzh.ch/docs/VO_Part_II_Scaramuzza.pdf

[5] - https://www.cs.ubc.ca/~lowe/papers/ijcv04.pdf

[6] - http://www.willowgarage.com/sites/default/files/orb_final.pdf

[7] - https://web.yonsei.ac.kr/jksuhr/articles/Kanade-Lucas-Tomasi%20Tracker.pdf

[8] - http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.411.2842&rep=rep1&type=pdf

[9] - https://www.ri.cmu.edu/pub_files/2014/9/IROS_2014.pdf

[10] - http://www.cs.jhu.edu/~misha/ReadingSeminar/Papers/Triggs00.pdf

[11] - https://elibrary.ru/item.asp?id=39183350

[12] - https://vo2019-qwembe.notebooks.azure.com/j/notebooks/EMatrix.ipynb

[13] - https://vo2019-qwembe.notebooks.azure.com/j/notebooks/05%20Calculate%20track%20from%20essential%20matrix.ipynb

[14] - https://github.com/qwembe/vo2019
