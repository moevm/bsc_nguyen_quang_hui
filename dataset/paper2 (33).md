# Обзор методов фотограмметрии для задач 3D-сканирования зданий

Ключевые слова: фотограмметрия, Digital Image Correlation, Marker Tracking, Point Tracking, Edge detection, обзор

## Аннотация

В основе большинства классических методов фотограмметрии лежит решение проблемы ориентации и позиционирования камеры во время процесса съемки. Большое разнообразие методов фотограмметрии объясняется различными подходами к решению данной проблемы. В работе автор рассматривает основные методы фотограмметрии (Marker Tracking, Point Tracking, Edge detection, Digital Image Correlation, c использованием внешних сенсоров) и принципы их работы. Автор выявляет проблемы, возникающие при трехмерном сканировании зданий, какие ограничения накладывает поставленная задача. Автор выполняет сравнительный анализ методов фотограмметрии на основе сформированных критериев и выявленных проблем при сканировании зданий. На основе сравнительного анализа составляется классификация методов. В результате обзора выявлено, что подходящим методом фотограмметрии для задач трехмерного сканирования зданий является метод Edge Detection, потому что данный метод не накапливает ошибок и не требует предварительной подготовки модели.

## Введение

В настоящее время с развитием трехмерной графики возможность создавать трехмерные модели существующих объектов возросла многократно, в том числе и в архитектуре. Учитывая разнообразие сканируемых объектов, технологий и инструментов, появилось множество фотограмметрических методов трехмерной реконструкции объекта.

Цель статьи заключается в том, чтобы построить классификацию методов фотограмметрии для трехмерного сканирования зданий.

Для решения проблемы выбора конкретного метода фотограмметрии для задачи трехмерного сканирования зданий, возникающей из-за разнообразия существующих методов, необходимо решить следующие задачи:

1. Рассмотреть существующие методы фотограмметрии и принципы их работы.
2. Сформировать критерии сравнения методов фотограмметрии.
3. Выявить проблемы, возникающие при трехмерном сканировании зданий.
4. Сравнительный анализ методов фотограмметрии на основе сформированных критериев и выявленных проблем при сканировании зданий.
5. Составить классификацию методов фотограмметрии на основе сравнительного анализа.
6. Описать рекомендации по выбору метода фотограмметрии в зависимости от конкретной задачи сканирования здания.


# Сравнение методов

## Принцип отбора

Методы фотограмметрии выбирались на основе методов позиционирования и ориентирования камеры. В обзоре участвуют методы, для которых репозитории с реализациями методов на GitHub имеют более 100 звезд. 

### Marker Tracking 

Маркер - это прямоугольник или квадрат со вписанным вовнутрь идентификатором-образом (примерами маркеров являются ArToolKit [1], ArUco [2]).
Если снимок содержит заранее подготовленный маркер на объекте, который можно распознать, то можно точно рассчитать положение камеры относительно маркера благодаря известным фиксированным размером маркера. Эти данные затем могут быть использованы для расчета изменения положения в пространстве камеры и соответственно сделанных снимков, для создания модели [3].

### Point Tracking 

Метод отслеживания точек (Point Tracking) использует камеру для определения координат дискретных точек.
Отслеживаемыми объектами обычно являются высококонтрастные или яркие точки на снимках, выступающие в роли ориентиров. Например, темные точки соприкосновения частей на углах или свет от точечного источника. По снимкам можно вычислить изменение положения данных объектов, тем самым найти траекторию движения камеры. Используя данные о движении камеры, можно вычислить смещение каждого снимка для построения модели объекта [4].

### Edge detection

Алгоритм обнаружения границ (edge detection) работает на основе того факта, что можно обнаружить динамику изменения объекта можно используя границы этого объекта. Для этого необходимо распознать на снимках геометрические примитивы и найти их углы. Существует несколько способов обнаружения границ объекта - sub pixel algorithms, Hough Transform [4].

### Digital Image Correlation

В отличие от алгоритмов, основанных на point tracking и marker tracking, которые используют пару заданных ориентиров для определения смещения камеры, алгоритмы основанные на Digital Image Correlation, выделяют как можно больше контрастных пикселей на снимках для отслеживания и идентификации изображений. Увеличенное количество отслеживаемых ориентиров и вычисление среднего смещения повышает точность смещения камеры [4]. 

### С использованием внешних сенсоров

Для отслеживания изменения положения камеры можно использовать специальные внешние сенсоры (акселерометр, гироскоп, магнитометр), которые помогут отслеживать положение камеры. Некоторые камеры (например, Kinect или Depth Camera D435i Intel RealSense) оснащены такими сенсорами, что позволяет использовать их для реконструкции объектов [5]. 


## Критерии сравнения аналогов

### Вычислительная сложность отслеживания изображений

Вычислительная сложность и зависит от выбранного метода и размеров изображения NxM. 
- Низкая - обработка изображения не выполнялась или был сделан один обход по изображению (O(NxM))
- Высокая - были выполнены дополнительные нелинейные вычисления, сложность выше O(NxM)

### Необходимость предварительной подготовки объекта

Для создания трехмерной модели необходимо выполнить определенные действия перед процессом съемки. 
Например, наклеить маркеры или установить ориентиры.   

### Наличие накопления ошибок

Накопление ошибки - это такой эффект, значение ошибки (неточности склеивания модели) на некотором шаге пропорционально увеличивается на значение ошибки на предыдущем шаге склеивания модели (обработки предыдущего снимка). 


## Таблица 1 - Сравнение методов по критериям
|   |  Необходимость предварительной подготовки объекта | Вычислительная сложность | Наличие накопления ошибок |
| --- | --- | --- | --- |
| Marker Tracking | Да | Низкая | Нет |
| Point Tracking | Да | Низкая | Нет |
| Edge detection | Нет | Высокая | Нет |
| Digital Image Correlation | Нет | Высокая | Да |
| С использованием внешних сенсоров | Нет | Низкая | Да |


## Выводы по итогам сравнения
 
Как видно из таблицы 1, лучший метод создания модели без предварительной ее подготовки является Edge detection, потому что не накапливает ошибок. В случае, если нам необходимо создать трехмерную модель без предварительной ее подготовки и без вычислительно сложных процессов, то можно использовать внешние сенсоры для ориентирования камеры. 

Marker Tracking и Point Tracking обладают одинаковыми характеристиками, однако использование Point Tracking для задачи трехмерной реконструкции зданий не всегда уместно, так как данный метод ищет высококонтрастные точки и может некорректно их определить в очень солнечную или дождливую погоду. 

Методы с низкой вычислительной сложностью требуют предварительной подготовки модели, если необходима точность.


## Проблемы, возникающие при реконструкции зданий

Используя фотограмметрию, можно создать трехмерную модель практически любого объекта. Однако,  учитывая разнообразие сканируемых объектов, технологий и инструментов, сложность сканирования объекта сильно варьируется в зависимости от выбранного метода и объекта.

Рассмотрим процесс реконструкции зданий. Здание - крупные объект, размеры которого более 1 метра по каждому измерению. Соответственно, чтобы запечатлеть при помощи фотоаппарата или другого фотографирующего устройства все стороны здания понадобится более 1 снимка на каждую сторону. Исходя из этого процесс съемки занимает продолжительное время, чтобы заснять все части здания полностью.
Второй важной особенностью процесса реконструкции зданий является тот факт, что здания расположены на улице в открытом пространстве. Влияние погодных условий при создании снимков имеет большое значение. Например, наличие солнечных бликов или дождя способно исказить процесс отслеживания положения камеры, что напрямую влечет к увеличению неточности создаваемой модели. 


##  Выбор метода решения 

В результате обзора аналогов было выявлено, что подходящим методом фотограмметрии для задач трехмерного сканирования зданий является метод Edge Detection. 

Учитывая тот факт, что размеры зданий достаточно велики, то соответственно необходимо делать большое количество снимков для создания полной трехмерной модели здания со всех сторон. Важным критерием при выборе метода является накопление ошибок, так как при большом объеме данных точность получаемой трехмерной модели низкая. Исходя из этого факта, алгоритмы, основанные на методах Digital Image Correlation и с использованием внешних сенсоров, не подходят для этой задачи.

Процесс съемки здания происходит в дневное время суток, исходя их этого, метод Point Tracking, основанный на поиске контрастных или ярких ориентиров, не является подходящим, так как есть высокая вероятность ошибочного распознавания в солнечную погоду. 

Исходя из принципа, что размеры зданий велики, крепление маркеров на фасады здания займет продолжительное время, причем в полученной модели будут видны запечетлённые маркеры, поэтому необходима дополнительная постобработка. В виду этого метод Marker Tracking также не является наилучшим, но в тоже время обеспечивает хорошую точность и сложность вычислений.

Необходимо учесть факт, что комбинирование нескольких методов при реконструкции здания позволит корректировать точность одного метода, на основе данных другого. Например, задействовать данные сенсоров для определения текущего положения камеры при использовании алгоритмов Digital Image Correlation. Таким образом, для ориентирования положения камеры уже будет два источника, тем самым повышая точность получаемой модели. 


## Классификация методов

На основании проделанной работы и составленной таблицы сравнения методов составлена следующая классификация методов фотограмметрии.

**1. По точности**:

* Точные методы

   * Marker Tracking
   * Point Tracking
   * Edge detection
   
* С накоплением ошибок

   * Digital Image Correlation
   * С использованием внешних сенсоров
   

**2. По сложности подготовки модели:**

* Требуется предварительная подготовка модели

   * Marker Tracking
   * Point Tracking
   
* Подготовка не нужна

   * Edge detection
   * Digital Image Correlation
   * С использованием внешних сенсоров
   
  
## Рекомендации по выбору метода 

Выбор конкретного метода фотограмметрии зависит от размеров здания. В случае, если размеры здания небольшие и позволяют обойти со всех сторон за пару минут, то возникает возможность прикрепить к зданию ориентиры (маркеры), благодаря которым можно отслеживать положение камеры для методов Marker Tracking или Point Tracking. В остальных случаях, когда размеры здания не позволяют обклеить здание маркерами можно использовать методы Edge detection, Digital Image Correlation или с использованием внешних сенсоров. 

 
## Заключение

В рамках данной статьи была достигнута поставленная цель – построение классификации методов фотограмметрии для трехмерного сканирования зданий. Для этого был проведен сравнительный анализ методов фотограмметрии на основе сформированных критериев ("Необходимость предварительной подготовки объекта", "Вычислительная сложность", "Наличие накопления ошибок") и выявленных проблем при сканировании зданий (погодные условия и размеры здания). На основе сравнительного анализа составлена классификация методов. Описаны рекомендации по выбору метода в зависимости от размера здания. 


В дальнейшем следует расширить анализ, добавив в сравнение стереофотограмметрические методы, основанные на использовании стереоскопического фотоаппарата или нескольких фотоаппаратов сразу и методы для лазерных камер (например, LIDAR).

