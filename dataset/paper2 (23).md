# Исследование приведения двухуровневой кооперативной задачи о назначениях к задаче Travelling Salesman Problem (TSP).

Ключевые слова: tsp, задача коммивояжера, np-полнота, задача о назначениях, сложность, алгоритм приведения

## Аннотация
Статья посвящена актуальной на сегодняшний день проблеме приведения одних NP-полных задач к другим. Основное внимание в работе автор акцентирует на алгоритме приведения двухуровневой кооперативной задачи о назначениях к задаче Travelling Salesman Problem для поиска решения задачи. В статье проанализированы аспекты точности решения задачи, сложности вычисления. Автор приходит к выводу, что несмотря на то, что решение двухуровневой задачи о назначениях при помощи приведения ее к TSP не является точным при условии использования алгоритма Лина-Кернигана для решения задачи коммивояжера, алгоритм приведения имеет меньшую сложность вычисления, чем существующий в настоящее время алгоритм, основанный методом ветвей и границ, а значит является более выгодным в случае, когда не требуется идеальная точность. Также в статье приведены доказательства корректности работы алгоритма и рассмотрен пример его работы. 
	
## Введение
Задача о назначениях является одной из фундаментальных задач комбинаторной оптимизации в области математической оптимизации или исследовании операций. В данной статье рассматривается решение двухуровневой задачи о назначениях (2-ЗОН), принадлежащей к числу NP-полных задач. Двухуровневость задачи дает возможность рассмотреть классическую задачу при дополнительном условии/задачи. В настоящее время для решения линейной задачи о назначениях разработан алгоритм, решающий ее за полиномиальное время от числа работ. Но двухуровневая задача вычислительно сложна даже в частном случае. Одним из лучших алгоритмов для ее решения на данное время считается алгоритм основанный на методе ветвей и границ [1], теоретическая оценка нахождения верхнего уровня при уже найденном решении нижнего уровня которого О(n^3), где n − число исполнителей нижнего уровня. В работе представлен алгоритм приведения двухуровневой кооперативной задачи о назначениях к задаче коммивояжера. Вычислительно легкое приведение может улучшить вычислительную сложность решения задачи, так как для решения задачи коммивояжера существует алгоритм Лина-Кернигана, сложность которого составляет приблизительно O(n^2.2) [2]. 
	
Цель статьи заключается в том, чтобы разработать алгоритм приведения двухуровневой кооперативной задачи о назначениях к задаче коммивояжера, для уменьшения вычислительной сложности решения задачи по сравнению с алгоритмом ветвей и границ.

В статье будут решаться следующие  задачи: 
1) Определить качества, которыми должен обладать алгоритм приведения.
2) Точно сформулировать задачи 2-ЗОН и TSP.
3) Разработать алгоритм приведения кооперативной 2-ЗОН к задаче коммивояжера. 
4) Доказать, что алгоритм верно находит решение задачи о назначениях. 
5) Показать, что вычислительная сложность решения задачи уменьшилась.
## Выбор качеств алгоритма приведения
В первую очередь рассмотрим некоторые алгоритмы приведения одних NP-полных задач к другим. 

В обзорной статье о полиномиальных преобразованиях между NP-полными задачами [3] представлено преобразование с использованием теории графов NP-полной задачи о гамильтоновом цикле (ГЦ) к задаче TSP. Алгоритм преобразования создает полностью связный граф с тем же числом вершин, что и экземпляр ГЦ. Затем присваивает вес каждому ребру: 1, если экземпляр ГЦ содержит это ребро, и n+1 в противном случае (n число вершин в графе).

В труде «Алгоритмы. Построение и анализ» [4] представлено доказательство, что задача о клике NP-полна. Доказательство происходит путем сопоставления конъюнкции скобок, каждая из которых есть дизъюнкция не более трех литералов, графа, вершинами которого будут все вхождения всех литералов. Два вхождения соединены ребром, если они находятся в разных скобках и совместимы.

В статье [2] Р.М. Ларин и А.В. Пяткин доказывают, что 2-ЗОН является NP-полной. Для этого формулируется вспомогательная задача. Доказывается, что она полиномиально сводится к 2-ЗОН и что NP-полную задачу о клике можно свести к этой вспомогательной задаче. Доказательства представлены полиномиальным преобразованием с использованием теории графов.

В каждой из этих трех работ использовалось преобразование с использованием теории графов, решение приводимой задачи определялось точно, для получения корректного решения исходной задачи, и алгоритмы приведения выполнялись за полиномиальную сложность. Так как различные решения задачи коммивояжера связаны с графами, то обобщая все сказанное можно сделать вывод, какими качествами должен обладать алгоритм приведения двухуровневой кооперативной задачи о назначениях к задаче коммивояжера:
1) приведение должно основываться на теории графов;
2) при приведении одной задачи к другой, решение не должно терять точность; 
3) сведение должно обладать полиномиальной сложностью или хотя бы приближенной к ней, чтобы решение двухуровневой задачи о назначениях через TSP имело смысл.
## Определение задачи TSP. 
Теперь дадим точное определение задачи коммивояжера и основным определениям, используемым в ней.

Существует n городов. Каждый город характеризуется следующими величинами:

xij − существование пути из города i в город j: xij=1, если путь существует, и xij=0 в противном случае;

cij − стоимость пути из города i в город j, cij≥0.

Задача коммивояжера состоит в нахождении минимального пути, который проходит через данные города хотя бы один раз с последующим возвратом в исходный город.

Представление задачи TSP в виде графа имеет следующий вид.

Ориентированный граф G=(V, E) является экземпляром TSP, если |V|=n и eij=cij, если x_ij=1,i,j∈V. Задача состоит в нахождении гамильтонова цикла минимального веса.

Ориентированный граф − граф, ребра которого имеют направление.

Гамильтонов цикл − это цикл, проходящий через каждую вершину графа ровно один раз.
## Определение кооперативной 2-ЗОН: 
Определение кооперативной двухуровневой задачи о назначениях звучит следующим образом.

Существует заказчик, являющийся верхним уровнем, который способен предложить n видов работ. Данные работы выполняются m исполнителями, являющимися нижним уровнем. Заказчик характеризуется следующими величинами: 

xi − величина выбора заказчика: xi=1 при заказе работы вида i, и xi=0 в противном случае;

cij − затраты заказчика на выполнение работы вида i исполнителем j (i∈I, j∈J, |I|=n, |J|=m). 

Вектор х имеет длину n и состоит из нулей и единиц − заказчик может заказать любую совокупность работ или отказаться от выполнения всех работ. Пусть I(x)={i∈I, xi=1} − множество заказанных работ в вари¬анте выбора х. Но заказчику выгоднее заказать максимум работ, которые могут быть выполнены одновременно: |I(x)|=m.

Исполнители характеризуются следующими параметрами: 

yij — параметр выбора исполнителей: уij=1 при выполнении исполнителем j работы вида i, и уij=0 в противном случае; 

dij — доход исполнителя j от выполнения работы i (i∈I,j∈J). 

Каждый исполнитель может выбрать только один вид работ I(x), предлагаемых заказчиком, и каждый вид работ может быть выполнен только одним исполнителем. 

Задача нижнего уровня состоит в назначении работ так, чтобы максимизировать суммарный доход исполнителей. Задача верхнего уровня состоит в минимизации затрат заказчика с учетом решении исполнителей о выборе работ.

Рассмотрим постановку двухуровневой кооперативной задачи о назначениях.

Пусть I={1,...,n}, J={1,...,m}, x = (x1,...,xn), y=(yij)i∈I,j∈J. Пусть заданы две вещественные матрицы С = (cij)i∈I,j∈J и D = (dij)i∈I,j∈J. Считаем, что n≥m. 

![](https://github.com/moevm/scientific_writing-2019/blob/6381_Sheveleva_AM/6381_Sheveleva_AM/2019-12-10_15-58-16.png)

Задача (1) называется задачей верхнего уровня, а задача (2) — ниж¬него уровня. Нижний уровень является классической задачей о назна¬чении. Верхний уровень рассчитывает на наилучший выбор нижнего уровня.	
## Алгоритм приведения 2-ЗОН к TSP:
Известно, что двухуровневая задача о назначениях является NP-полной [2]. Следовательно, приведем ее к задаче коммивояжера.

Обозначим через

n(xi=1) − заказанные исполнителями работы, количество которых равняется m − количеству исполнителей.

V − вершины графа экземпляра TSP G = (V, E), количество которых равняется m+n(xi=1).

Е − ребра графа экземпляра TSP G = (V, E), в начальной записи являющийся пустым множеством. 

Алгоритм, реализующий приведение кооперативной 2-ЗОН к TSP, состоит из последовательности следующих шагов.

Шаг 1. Построим граф G = (V, E).

Шаг 2. Добавим ребра к множеству Е, идущие из вершин m к каждой вершине n(xi=1), с весом dij - 1/cij. 

Шаг 3. Построим ребра из вершин n(xi=1) к каждой вершине m с весом 0. 

Шаги 2 и 3 выполняются до тех пор, пока не пройдем по всем вершинам m и n(xi=1).

Приведем псевдокод алгоритма:

![](https://github.com/moevm/scientific_writing-2019/blob/6381_Sheveleva_AM/6381_Sheveleva_AM/2019-12-10_16-00-22.png)

Приведем пример работы алгоритма.

1. Начальные данные задачи приведены в табл. 1-2. Вычислим точное решение задачи о назначениях для n=4, m=3 . 

Таблица 1 − Матрица C

| m\n | n1 (x=1) | n2 (x=1) | n3 (x=1) | n4 (x=0) |
|-----|----------|----------|----------|----------|
| m1  | 2        | 1        | 2        | 3        |
| m2  | 1        | 4        | 2        | 3        |
| m3  | 3        | 2        | 1        | 3        |

Таблица 2 − Матрица D

| m\n | n1 (x=1) | n2 (x=1) | n3 (x=1) | n4 (x=0) |
|-----|----------|----------|----------|----------|
| m1  | 3        | 5        | 4        | 3        |
| m2  | 2        | 5        | 3        | 3        |
| m3  | 5        | 4        | 1        | 3        |

Таблица 3 − Матрица вычислений

| m1 | m2 | m3 | Суммы решений матрицы C | Суммы решений матрицы D |
|----|----|----|-------------------------|-------------------------|
| n1 | n2 | n3 | 2+4+1=7                 | 3+5+1=9                 |
| n1 | n3 | n2 | 2+2+2=6                 | 3+3+4=10                |
| n2 | n1 | n3 | 1+1+1=3                 | 5+2+1=8                 |
| n2 | n3 | n1 | 1+2+3=6                 | 5+3+5=13                |
| n3 | n1 | n2 | 2+1+2=5                 | 4+2+4=10                |
| n3 | n2 | n1 | 2+4+3=9                 | 4+5+5=14                |
	
По формуле (2) минимальным результатом в табл. 3 по значениям матрицы D является 8, при (m1,m2.m3) - (n2,n1,n3). По формуле (1) минимальное значение в С с учетом предыдущего результата является значение 3. Ответ: (m1,m2.m3) - (n2,n1,n3).

2. Приведем задачу к tsp по алгоритму. Полученный граф представлен на рис. 1.

![](https://github.com/moevm/scientific_writing-2019/blob/6381_Sheveleva_AM/6381_Sheveleva_AM/2019-12-10_15-25-56.png)

Рисуной 1 - TSP экземпляр графа задачи 2-ЗОН 

3. Решим задачу коммивояжера. 

Решение m1->n2->m2->n1->m3->n3->m1 ((m1,m2.m3) - (n2,n1,n3)) и результат равен 5 (= 8-(1/1+1/1+1/1)).

Результаты решений совпали.
## Исследование алгоритма
Исследуем алгоритм приведения на сохранение точности решения и определим вычислительную его сложность.

Известно, что в кооперативной 2-ЗОН первым находится минимум
![](https://github.com/moevm/scientific_writing-2019/blob/6381_Sheveleva_AM/6381_Sheveleva_AM/2019-12-10_16-00-01.png)
  
В представленном алгоритме также более весомым является значение dij в (dij-1/сij) -> min, т.к. в общем случае dij  >> 1/сij. Из этого следует, что будет выбираться сначала минимальное значение dij , а уже потом минимальное значение -1/сij на основе полученных минимальных значений dij, что соответствует нахождению решения задачи верхнего уровня. 

При малых значениях dij  и сij алгоритм может давать не точный результат. Но это легко исправить делением значения -1/сij  на 10, чем понижается значимость второго слагаемого.

Из вышеперечисленного можно сделать вывод, что алгоритм приведения сохраняет точность решения двухуровневой задачи.

Теперь определим вычислительную сложность алгоритма. В алгоритме дважды используется двойной цикл по значениям m и по значениям n=1. Из этого следует, что:
	
О(n*m)+O(n*m)=2O(n*m)=O(n*m).

Из условия, что n=m следует, что 
	
O(n*m) = O(m2).

Следовательно, вычислительная сложность алгоритма − квадратичная.
## Сравнение алгоритма приведения и алгоритма ветвей и границ.
Алгоритм ветвей и границ дает точное решение задачи верхнего уровня. Для задачи нижнего уровня существует венгерский алгоритм, который также дает точное решение задачи. Алгоритм приведения не влияет на точность решения, но существующий алгоритм Лина-Кернигана, хоть и считается одним из самых эффективных методов поиска оптимальных решений задачи коммивояжера, но не является алгоритмом точного решения. 

Вычислительная сложность алгоритма ветвей и границ и венгерского алгоритма равна О(m^3), в то время как сложность алгоритма приведения O(m^2), а сложность алгоритма Лина-Кернигана равна O(m^2.2).

Из данных результатов можно сделать вывод, что при небольшой потери точности решения задачи 2-ЗОН, приведение сильно выигрывает в уменьшении сложности решения задачи.

## Заключение
В статье представлен алгоритм приведения двухуровневой кооперативной задачи о назначениях к задаче коммивояжера для поиска решения задачи. В аспекте точности решения исследование показало, что решение двухуровневой задачи о назначениях через приведение к задаче коммивояжера не выгодно, так как алгоритм Лина-Кернигана не дает точного решения, а использование точных алгоритмов для решения задачи коммивояжера не выгодно из-за возрастающей сложности алгоритма. Тем не менее, было определено, что сложность такого решения сильно уменьшается, по сравнению с прямым решением 2-ЗОН. Автор пришел к выводу, что решение через приведение к TSP является более выгодным, при условии, что не требуется идеально точное решение.

В дальнейшем, эти результаты следует распространить и на исследование, в котором будут приводиться другие NP-полные задачи, решения которых в настоящее время имеют большую вычислительную сложность, к задаче коммивояжера. Это может оказаться важной областью будущих исследований оптимизации работы алгоритмов, основанных на NP-полных задач. 

