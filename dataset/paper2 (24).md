# Разработка шутера с видом от первого лица на базе WEBVR и фреймворка A-Frame

Ключевые слова: VR, WebVR, A-Frame, Three.js, Babylon.js, React360, WebVR API.

## Аннотация

В данной работе была исследована проблема разработки приложений с использованием инструментов для работы с VR технологиями в браузере. Для решения проблемы была поставлена цель разработать шутер с видом от первого лица на базе WEBVR. В процессе исследования были рассмотрены технологии работы с VR-технологиями, необходимые для реализации приложения. Был произведен сравнительный анализ наиболее популярных фреймворков и библиотек для работы с 3D-графикой, в результате которого был выявлен наилучший из рассматриваемых, удовлетворяющий составленным критериям в наибольшой степени. Были выбраны все необходимые инструменты для создания приложения, исходя из необходимых преимуществ. Кратко сформулированы основные этапы создания игры.


## Введение
Сегодня WEBVR - быстро развивающаяся компьютерная технология. Развитие средств для взаимодействия человека с компьютером, сбора информации об окружающей среде и появление инструментов для связи WEB и VR-технологий привел к появлению реалистичных виртуальных миров в браузере. Одним из основных направлений развития WEBVR являются компьютерные игры. В которых пользователь погружается в компьютерную игру, перемещается в ней и взаимодействует с виртуальными объектами, используя специальные средства отображения и взаимодействия системы виртуальной реальности. На данный момент существует малое количество компьютерных игр, построенных на базе WEBVR, в следствии сложности и новизны совместного использования WEB и VR-технологий. Из вышесказанного возникает проблема, которая заключается в разработке приложений с использованием инструментов для работы с VR технологиями в браузере. 

Для частичного решения данной проблемы возникла идея разработать игру на базе WEBVR. Согласно рейтингу наиболее популярных жанров компьютерных игр в 2019 году [1], жанром создаваемой игры был выбран шутер от первого лица, так как он не требует создание большого мира, проработки сюжета и достаточно популярен, что позволит увеличить количество пользователей, использующих разрабатываемую игру. Таким образом, целью данной работы является разработка шутер с видом от первого лица на базе WEBVR. Объектом исследования является технология разработки приложений с совместным использованием WEB и VR технологий. Предметом исследования является использование WebVR API для разработки игр с виртуальной реальностью в браузере.

Для достижения цели необходимо решить следующие задачи:
1. рассмотреть существующие библиотеки или фреймворки, работающие с 3D-графикой;
2. разработка шутера с видом от первого лица на базе WEBVR и фреймворка A-Frame;
3. тестирование разработанной игры.

## Обзор предметной области

### Принцип отбора аналогов
 
Для того, чтобы выявить, что должно представлять из себя разрабатываемое приложение и какими качествами оно должно обладать, необходимо рассмотреть существущие аналоги. Для обзора существующих решений были выбраны технологии, позволяющие создавать и отображать анимированную компьютерную 3D графику при разработке веб-приложений. Рассмотренные аналоги обязательно должны иметь инструменты для работы с виртуальной реальностью. Среди множества библиотек и фреймворков, решающих поставленную проблему были выбраны наиболее популярные, отбор происходил по количеству человек, добавивших репозиторий в закладки на github[2]. 

#### **Three.js** [3] 
JavaScript-библиотека, необходимая для создания и отображения анимированной компьютерной 3D графики при разработке веб-приложений. Преимуществами данной библиотеки являются кроссплатформенность и легковесность, недостатками - отсутствие готовых модулей и компонентов.

#### **Babylon.js** [4]
JavaScript-фреймворк трехмерной графики на базе WebGL, в основном предназначенный для разработки игр. Имеет изначальную поддержку Oculus Rift и других устройств виртуальной реальности. В нем есть инструменты для создания, отображения и наложения текстур на модели в пространстве, а также для добавления источников света и камер. 

#### **React360** [5] 
JavaScript-библиотека, позволящая создавать пользовательские интерфейсы в 3D и VR. Она основана на библиотеке Three.js. React360 имеет те же концепции, функции и преимущества React JS, поэтому разработчик должен быть знаком с React [6]. Библиотека позволяет создавать интерактивность в мирах с обзором в 360 градусов. Приложения, которые объединяют 2D или 3D интерфейсы, могут разработаны с помощью React360.

#### **A-Frame** [7] 
HTML-фреймворк для создания веб-приложений и сайтов под виртуальную реальность с помощью которого можно сверстать VR мир с минимальными усилиями. Сам фреймворк базируется на Threejs и является более высокоуровневой надстройкой. Фреймворк A-Frame создает 3D-сцену через набор геометрических примитивов, основываясь на HTML-разметке, и отрисовывает при помощи WebGL. Является мощным множеством компонентов, обеспечивающее уникальную декларативную структуру с возможностью расширения и компоновки.

#### **Unity WebVR Assets** [8] 
Инструмент, позволяющий авторам публиковать приложения с виртуальной реальностью, которые они создали в игровом движке Unity, в открытый Интернет с помощью ссылки. Поскольку инструмент основан на стандартах API WebVR, он устраняет необходимость в любых SDK для конкретных платформ и предоставляет возможность реагировать на различные конфигурации VR.

### Критерии сравнения аналогов

#### **Наличие готовых модулей и компонентов**. 
В рамках данного критерия были рассмотрены компоненты и модули, встроенные в библиотеку/ фреймворк, а не написанные другими пользователями и выложенные для всеобщего пользования. Готовые компоненты и модули позволят не только ускорить работу разработчикам, но и позволят писать оптимизированный код, который скажется на скорости работы разрабатываемого приложения.

#### **Совместимость браузеров**. 
Так как современные пользователи сети Интернет имеют широкий выбор браузеров, совместимость фреймворка или библиотеки с различными современными браузерами является важным критерием отбора аналогов, из-за возможной потери потенциальных посетителей, поскольку для них разрабатываемое приложение будет недоступным или трудным для просмотра. В первую очередь необходимо поддерживать наиболее популярные браузеры, так как именно их пользователи смогут воспользоваться разрабатываемым приложением. Поддерживаемые браузеры отбирались согласно статистики [9] и информации, взятой с сайта разработчика.

#### **Язык программирования**. 
Один их основых критериев выбора инструмента, работающего с 3D графикой. Позволяюет разработчику выбрать наиболее подходящий для него инструмент исходя из преимуществ и недостатков языка программирования. Процесс разработки пойдет тем быстрее, чем больше навыков имеет программист в конкретном языке. Ключевым преимуществом JavaScript в сравнении с другими языками прикладного программирования является кроссплатформенность созданных приложений. Игры, написанные с помощью JS, выглядят и работают одинаково на всех операционных системах.

#### **Наличие визуального редактора**. 
Визуальный редактор упрощает и ускоряет разработку создаваемого приложения.

### Таблица сравнения по критериям
|                                	| Three.js   | React360            		 	| A-Frame    		   | Babylon.js   | Unity WebVR Assets   	 |
| ---------------------------------	| ---------- | ---------------------------- | -------------------- | ------------ | ------------------------ |
| Язык программирования      	 	| JavaScript | JavaScript с расширением JSX | JavaScript и HTML    | JavaScript   | C# 					  	 |
| Совместимость браузеров	        | последнии версии Chrome, Safari, Firefox		 | последнии версии Chrome, Firefox и Microsoft Edge		          		 	| последнии версии Firefox, Samsung Internet, Microsoft Edge, Google Chrome, Safari, Internet Explorer 11+,   | Internet Explorer 11+, Firefox 4+, Google Chrome 9+ and Opera 15+			  | последнии версии Firefox, Microsoft Edge	                 |
| Наличие готовых модулей и компонентов | - | - | + | - | + 
| Наличие визуального редактора  	| + 		 | - 						 	| + 				   | + 		  | + 					  	 |   

### Выводы по итогам сравнения

Так как Three.js, A-Frame, React360 и Babylon.js написаны на языке программирования JavaScript, они больше подходит для поставленной задачи. А Unity WebVR Assets написан на языке С# и в силу специфики своей архитектуры использует трансляцию кода из C# в С++ и далее в JavaScript, имеет низкую производительностью из-за нагруженности процессора, что сильно скажется на производительности создаваемой игры.

Рассматривая критерий "Совместимость браузеров", явным лидером является A-Frame из-за большого количества поддерживаемых браузеров, что позволит увеличить потенциальное количество пользователей, использующих разрабатываемое приложение.

A-Frame и Unity WebVR Assets имеют готовые модули и компоненты, использование которых ускорит работу разрабатываемой игры.

Визуальным редактором обладают Three.js, A-Frame, Babylon.js и Unity WebVR Assets.

По итогам сравнения, можно выделить двух явных претендентов, имеющих визуальный редактор, готовые модули и компоненты. Это A-Frame и Unity WebVR Assets. 

## Выбор метода решения
В результате обзора фреймворков и библиотек, работающих с 3D-графикой, было выявлено два претендента (A-Frame и Unity WebVR Assets), которые имеют визуальный редактор, готовые модули и компоненты. Вследствие этого необходимо рассмотреть их подробнее. Unity WebVR Assets графически превосходит A-Frame, но в силу специфики своей архитектуры (трансляция кода из C# в С++ и далее в JavaScript), имеет ряд нерешенных проблем с производительностью, потреблением памяти и работоспособностью на мобильных устройствах [10]. К тому же A-Frame имеет большое количество поддерживаемых браузеров, что позволит увеличить количество пользователей, использующих разрабатываемое приложение.

Таким образом, A-Frame является наилучшим из рассмотренных для разработки шутера с видом от первого лица с совместным использованием WEB и VR технологий.

## Описание метода решения

### Используемые технологии

В предыдущем разделе было решено использовать фреймворк A-Frame для работы с 3D-графикой, на основании чего выбирались используемые технологии. 

Для того, чтобы поиграть в создаваемый шутер от первого лица пользователю нужны будут специальные VR-устройства: такие как очки виртуальной реальности и контроллеры в форме оружия. Чтобы использовать данные VR-устройства был использован программный интерфейс WebVR API [11]. Данное API предоставляет инструменты для рендеринга картинки, для получения информации об устройстве, его возможностях и технических характеристиках, определения текущих координат и углов обзора в трехмерном пространстве и выводе графической информации на используемое устройство.

Был написан сценарий использования WebVR API, согласно которому реализовано подключение интерфейса к разрабатываемому приложению, обработка каждого возможного события на действие пользователя и вывод картинки под очки виртуальной реальности.

#### Основной сценарий использования WebVR API
1. Запрос доступных VR-устройств
2. Проверка возможностей найденных устройств
3. В случае успеха объявление доступности устройства
4. Пользователь активирует устройство
5. В ответ на действие пользователя приложение запрашивает сессию виртуальной реальности
6. Запуск цикла рендеринга для генерации графики, отображаемой на устройстве
7. Завершение сессии виртуальной реальности в ответ на действие пользователя либо программно

В качестве языка разработки был выбран язык JavaScript и Html. Основным требованием при выборе была поддержка фреймворка A-Frame и WebVR API.

В качестве среды разработки был выбран WebStorm [12]. Главное достоинство которого это умный редактор для языков программирования JavaScript, HTML и CSS и фреймворка A-Frame. Также в WebStorm есть инструменты для отладки кода и интеграция с системы управления версиями.

Для создания моделей персонажей и предметов было выбрано программное обеспечение для 3D-моделирования и визуализации Blender [13]. В качестве аналогов рассматривались все представители рейтинга популярных 3D-редакторов [14], но Blender является бесплатным и имеет все необходимые средства для моделирования и анимации необходимых моделей.  

Были написаны основные этапы создания игры, согласно которым будет реализована создаваемая игра.

#### Основные этапы создания игры
1. Создание игровых сцен и персонажей
2. Реализация системы передвижений и обзора
3. Реализация взаимодействий с игровыми предметами
4. Реализация вражеских персонажей
5. Создание пользоватеского интерфейса

## Заключение
В ходе данного исследования был составлен обзор существующих технологий для работы с 3D-графикой и VR-технологиями.Лучшие результаты среди рассмотренных технологий показал фреймворк A-Frame, который не имеет проблем с производительностью, потреблением памяти и работоспособностью, что недопустимо в шутерах от первого лица. К тому же A-Frame имеет большое количество поддерживаемых браузеров, что позволит увеличить количество пользователей, использующих разрабатываемое приложение.

Были выбраны все необходимые инструменты для создания приложения, исходя из необходимых преимуществ.

Таким образом, цель работы была достигнута и появляется возможность для разработки улучшений приложения. Направление дальнейших исследований включает в себя добавление мультиплеера и новых дополнений к игре.


## Список литературы

1. Рейтинг наиболее популярных жанров компьютерных игр в 2019 году. [Электронный ресурс]. Url: https://invisioncommunity.co.uk/the-most-popular-video-game-genres-in-2019/
2. Roman Kucherenko 2019 WEBVR API DESCRIPTION AND A-FRAME APPLICATION IMPLEMENTATION. [Электронный ресурс]. Url: https://www.theseus.fi/bitstream/handle/10024/172421/Kucherenko_Roman.pdf?sequence=2&isAllowed=y
3. Библиотека three.js. [Электронный ресурс]. Url: https://threejs.org/ 
4. Фреймворк Babylon.js. [Электронный ресурс]. Url: https://www.babylonjs.com/
5. Библиотека React360. [Электронный ресурс]. Url: https://facebook.github.io/react-360/
6. Библиотека React - JavaScript-библиотека для создания пользовательских интерфейсов. [Электронный ресурс]. Url: reactjs.org
7. Фреймворк A-Frame. [Электронный ресурс]. Url: https://aframe.io/docs/0.9.0/introduction/
8. Инструмент Unity WebVR Assets. [Электронный ресурс]. Url: https://github.com/mozilla/unity-webvr-export
9. Статистика популярности браузеров. [Электронный ресурс]. Url: https://businessfire.ru/reyting-brauzerov/
10. Unity. [Электронный ресурс]. Url: https://sites.google.com/site/stelszombine3/home
11. WebVR API. [Электронный ресурс]. Url: https://developer.mozilla.org/en-US/docs/Web/API/WebVR_API
12. WebStrom. [Электронный ресурс]. Url: https://www.jetbrains.com/ru-ru/webstorm/
13. Blender. [Электронный ресурс]. Url: https://www.blender.org/
14. 3D-редакторы. [Электронный ресурс]. Url: https://videosmile.ru/lessons/read/obzor-samyih-populyarnyih-3d-redaktorov.html